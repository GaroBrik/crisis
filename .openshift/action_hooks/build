#!/bin/bash

export PATH="${PATH}:${OPENSHIFT_HOMEDIR}.gem/bin"

STATIC_DIR="${OPENSHIFT_REPO_DIR}static"
mkdir $STATIC_DIR
WEBCONTENT_DIR="${OPENSHIFT_REPO_DIR}webcontent"

echo "-----> compiling scss"
sass "${WEBCONTENT_DIR}/css/main.scss" "${STATIC_DIR}/main.css"

echo "-----> compiling js"
pushd "${WEBCONTENT_DIR}/js" > /dev/null
{
    OUTPUT="${STATIC_DIR}/compiled.js" 
    INPUT="goog.js main.js event.js coords.js bounds.js ajax.js division.js divisiondetails.js unit.js map.js routepoint.js"
    EXTERNS="jquiexterns.js jsonexterns.js jquery-1.9.js underscore-1.5.1.js"
    java -jar compiler.jar --compilation_level SIMPLE_OPTIMIZATIONS \
         --js $INPUT --externs $EXTERNS --js_output_file $OUTPUT --generate_exports \
         --warning_level VERBOSE --jscomp_warning=checkTypes
    cp -r "${WEBCONTENT_DIR}/js/thirdparty/." "${STATIC_DIR}/"
} >> "${OPENSHIFT_GO_LOG_DIR}go.log"
